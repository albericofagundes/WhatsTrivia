// const questions = [
//   {
//     category: "geral",
//     question: "Qual é o filme vencedor do Oscar de Melhor Filme em 2020?",
//     answer: "Parasite",
//     partialAnswer: ["Parasite"],
//   },
//   {
//     category: "geral",
//     question: "Quem dirigiu o filme 'Pulp Fiction'?",
//     answer: "Quentin Tarantino",
//     partialAnswer: ["Quentin Tarantino", "Tarantino"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do personagem interpretado por Robert Downey Jr. na franquia 'Iron Man'?",
//     answer: "Tony Stark",
//     partialAnswer: ["Tony Stark"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o filme com a maior bilheteria de todos os tempos?",
//     answer: "Avatar",
//     partialAnswer: ["Avatar"],
//   },
//   {
//     category: "geral",
//     question: "Quem ganhou o Oscar de Melhor Atriz em 2021?",
//     answer: "Frances McDormand",
//     partialAnswer: ["Frances McDormand", "McDormand"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o diretor do filme 'The Shawshank Redemption'?",
//     answer: "Frank Darabont",
//     partialAnswer: ["Frank Darabont", "Darabont"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o filme que conta a história de um naufrago em uma ilha deserta e é estrelado por Tom Hanks?",
//     answer: "Cast Away",
//     partialAnswer: ["Cast Away"],
//   },
//   {
//     category: "geral",
//     question: "Quem interpretou o Coringa no filme 'The Dark Knight'?",
//     answer: "Heath Ledger",
//     partialAnswer: ["Heath Ledger", "Ledger"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o filme de Quentin Tarantino que se passa durante a Segunda Guerra Mundial?",
//     answer: "Inglourious Basterds",
//     partialAnswer: ["Inglourious Basterds"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o filme vencedor do Oscar de Melhor Animação em 2022?",
//     answer: "Encanto",
//     partialAnswer: ["Encanto"],
//   },

//   {
//     category: "geral",
//     question:
//       "Qual é o nome da banda britânica conhecida pelo hit 'Bohemian Rhapsody'?",
//     answer: "Queen",
//     partialAnswer: ["Queen"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o cantor e compositor de 'Shape of You'?",
//     answer: "Ed Sheeran",
//     partialAnswer: ["Ed Sheeran", "Sheeran"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o álbum mais vendido de todos os tempos?",
//     answer: "Thriller",
//     partialAnswer: ["Thriller"],
//   },
//   {
//     category: "geral",
//     question: "Quem é a cantora conhecida pela música 'Hello'?",
//     answer: "Adele",
//     partialAnswer: ["Adele"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da música que se tornou um hit na voz de Luis Fonsi e Daddy Yankee?",
//     answer: "Despacito",
//     partialAnswer: ["Despacito"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o líder da banda U2?",
//     answer: "Bono",
//     partialAnswer: ["Bono"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o cantor conhecido pela música 'Thinking Out Loud'?",
//     answer: "Ed Sheeran",
//     partialAnswer: ["Ed Sheeran", "Sheeran"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é a banda de rock formada pelos irmãos Noel e Liam Gallagher?",
//     answer: "Oasis",
//     partialAnswer: ["Oasis"],
//   },
//   {
//     category: "geral",
//     question: "Qual é a música mais famosa da banda Nirvana?",
//     answer: "Smells Like Teen Spirit",
//     partialAnswer: ["Smells Like Teen Spirit"],
//   },
//   {
//     category: "geral",
//     question: "Quem é a cantora conhecida pelo hit 'Wrecking Ball'?",
//     answer: "Miley Cyrus",
//     partialAnswer: ["Miley Cyrus", "Cyrus"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o super-herói conhecido como o 'Homem de Ferro'?",
//     answer: "Tony Stark",
//     partialAnswer: ["Tony Stark", "Homem de Ferro"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do alter ego do Batman?",
//     answer: "Bruce Wayne",
//     partialAnswer: ["Bruce Wayne", "Batman"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o arqui-inimigo do Homem-Aranha?",
//     answer: "Duende Verde",
//     partialAnswer: ["Duende Verde", "Duende", "Green Goblin"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da ilha fictícia onde se passam as histórias de 'Tintin'?",
//     answer: "Sildávia",
//     partialAnswer: ["Sildávia", "Syldavia"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o alter ego do Flash?",
//     answer: "Barry Allen",
//     partialAnswer: ["Barry Allen", "Flash"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da heroína que é a princesa de Themyscira e conhecida como Mulher-Maravilha?",
//     answer: "Diana Prince",
//     partialAnswer: ["Diana Prince", "Mulher-Maravilha"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jornalista e fotógrafo que trabalha no Clarim Diário e é amigo do Homem-Aranha?",
//     answer: "Peter Parker",
//     partialAnswer: ["Peter Parker", "Homem-Aranha"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o vilão principal nas histórias do Super-Homem?",
//     answer: "Lex Luthor",
//     partialAnswer: ["Lex Luthor", "Luthor"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do detetive mascarado criado por Lee Falk?",
//     answer: "Fantasma",
//     partialAnswer: ["Fantasma", "The Phantom"],
//   },
//   {
//     category: "geral",
//     question: "Quem é o maior inimigo do Capitão América?",
//     answer: "Caveira Vermelha",
//     partialAnswer: ["Caveira Vermelha", "Red Skull"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome da novela que retratou a vida de Escrava Isaura?",
//     answer: "Escrava Isaura",
//     partialAnswer: ["Escrava Isaura"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual novela o personagem 'Zé Pequeno' foi interpretado por Leandro Firmino?",
//     answer: "Cidade de Deus",
//     partialAnswer: ["Cidade de Deus"],
//   },
//   {
//     category: "geral",
//     question: "Qual foi o programa de humor estrelado por Chico Anysio?",
//     answer: "Chico Anysio Show",
//     partialAnswer: ["Chico Anysio Show"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome da protagonista da novela 'Avenida Brasil'?",
//     answer: "Rita/Nina",
//     partialAnswer: ["Rita", "Nina", "Rita/Nina"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do programa dominical apresentado por Fausto Corrêa da Silva, mais conhecido como Faustão?",
//     answer: "Domingão do Faustão",
//     partialAnswer: ["Domingão do Faustão"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual novela a personagem 'Carminha' ficou marcada como a grande vilã?",
//     answer: "Avenida Brasil",
//     partialAnswer: ["Avenida Brasil", "Carminha"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da novela que retratou a história da fictícia cidade de Asa Branca?",
//     answer: "Roque Santeiro",
//     partialAnswer: ["Roque Santeiro", "Asa Branca"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da personagem interpretada por Susana Vieira na novela 'Por Amor'?",
//     answer: "Helena",
//     partialAnswer: ["Helena"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do programa de auditório apresentado por Silvio Santos?",
//     answer: "Programa Silvio Santos",
//     partialAnswer: ["Programa Silvio Santos"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual novela o personagem 'Santinho' foi interpretado por Ney Latorraca?",
//     answer: "Cambalacho",
//     partialAnswer: ["Cambalacho", "Santinho"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do programa de variedades apresentado por Xuxa Meneghel?",
//     answer: "Xou da Xuxa",
//     partialAnswer: ["Xou da Xuxa", "Xuxa"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da novela que se passa na fictícia cidade de Passaperto?",
//     answer: "Tieta",
//     partialAnswer: ["Tieta", "Passaperto"],
//   },

//   {
//     category: "geral",
//     question: "Qual é o maior oceano do mundo?",
//     answer: "Oceano Pacífico",
//     partialAnswer: ["Oceano Pacífico", "Pacífico"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o maior país em extensão territorial?",
//     answer: "Rússia",
//     partialAnswer: ["Rússia"],
//   },
//   {
//     category: "geral",
//     question: "Qual é a capital do Brasil?",
//     answer: "Brasília",
//     partialAnswer: ["Brasília"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o rio mais extenso do mundo?",
//     answer: "Rio Amazonas",
//     partialAnswer: ["Rio Amazonas", "Amazonas"],
//   },
//   {
//     category: "geral",
//     question: "Em qual continente está localizado o Egito?",
//     answer: "África",
//     partialAnswer: ["África"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o ponto mais alto da Terra?",
//     answer: "Monte Everest",
//     partialAnswer: ["Monte Everest", "Everest"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o país mais populoso do mundo?",
//     answer: "China",
//     partialAnswer: ["China"],
//   },
//   {
//     category: "geral",
//     question: "Em qual país está localizada a Torre Eiffel?",
//     answer: "França",
//     partialAnswer: ["França"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o maior deserto do mundo?",
//     answer: "Deserto do Saara",
//     partialAnswer: ["Deserto do Saara", "Saara"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o país com o maior número de ilhas no mundo?",
//     answer: "Suécia",
//     partialAnswer: ["Suécia"],
//   },
//   {
//     category: "geral",
//     question: "Em qual país está localizada a cidade de Machu Picchu?",
//     answer: "Peru",
//     partialAnswer: ["Peru"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o país com a maior área de floresta tropical?",
//     answer: "Brasil",
//     partialAnswer: ["Brasil"],
//   },

//   {
//     category: "geral",
//     question: "Em que ano ocorreu a queda do Império Romano do Ocidente?",
//     answer: "476",
//     partialAnswer: ["476"],
//   },
//   {
//     category: "geral",
//     question: "Quem foi o líder da Revolução Russa em 1917?",
//     answer: "Vladimir Lênin",
//     partialAnswer: ["Vladimir Lênin", "Lênin"],
//   },
//   {
//     category: "geral",
//     question: "Qual foi o imperador romano que legalizou o cristianismo?",
//     answer: "Constantino",
//     partialAnswer: ["Constantino"],
//   },
//   {
//     category: "geral",
//     question: "Qual foi o período conhecido como Idade das Trevas?",
//     answer: "Idade Média",
//     partialAnswer: ["Idade Média"],
//   },
//   {
//     category: "geral",
//     question: "Em que ano ocorreu a Revolução Francesa?",
//     answer: "1789",
//     partialAnswer: ["1789"],
//   },
//   {
//     category: "geral",
//     question: "Quem foi o líder sul-africano que lutou contra o apartheid?",
//     answer: "Nelson Mandela",
//     partialAnswer: ["Nelson Mandela", "Mandela"],
//   },
//   {
//     category: "geral",
//     question: "Qual foi a civilização que construiu as pirâmides de Gizé?",
//     answer: "Egípcios",
//     partialAnswer: ["Egípcios"],
//   },
//   {
//     category: "geral",
//     question: "Qual foi a primeira guerra mundial?",
//     answer: "Primeira Guerra Mundial",
//     partialAnswer: ["Primeira Guerra Mundial"],
//   },
//   {
//     category: "geral",
//     question:
//       "Quem foi o líder político que conduziu a independência da Índia?",
//     answer: "Mahatma Gandhi",
//     partialAnswer: ["Mahatma Gandhi", "Gandhi"],
//   },
//   {
//     category: "geral",
//     question: "Qual foi o imperador romano que ficou conhecido como 'O Louco'?",
//     answer: "Nero",
//     partialAnswer: ["Nero"],
//   },
//   {
//     category: "geral",
//     question: "Em que ano ocorreu a Queda do Muro de Berlim?",
//     answer: "1989",
//     partialAnswer: ["1989"],
//   },
//   {
//     category: "geral",
//     question:
//       "Quem foi o líder militar francês durante as Guerras Napoleônicas?",
//     answer: "Napoleão Bonaparte",
//     partialAnswer: ["Napoleão Bonaparte", "Napoleão"],
//   },

//   {
//     category: "geral",
//     question: "Qual é o nome do protagonista de 'Naruto'?",
//     answer: "Naruto Uzumaki",
//     partialAnswer: ["Naruto Uzumaki", "Naruto"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual série de anime/mangá os personagens usam o poder do 'ki'?",
//     answer: "Dragon Ball",
//     partialAnswer: ["Dragon Ball"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do criador do mangá 'One Piece'?",
//     answer: "Eiichiro Oda",
//     partialAnswer: ["Eiichiro Oda", "Oda"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do protagonista de 'Attack on Titan'?",
//     answer: "Eren Yeager",
//     partialAnswer: ["Eren Yeager", "Eren"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual anime/mangá os personagens jogam o jogo 'Duel Monsters'?",
//     answer: "Yu-Gi-Oh!",
//     partialAnswer: ["Yu-Gi-Oh!"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do protagonista de 'One Piece'?",
//     answer: "Monkey D. Luffy",
//     partialAnswer: ["Monkey D. Luffy", "Luffy"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual série de anime/mangá os personagens se tornam piratas espaciais?",
//     answer: "One Piece",
//     partialAnswer: ["One Piece"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do protagonista de 'Death Note'?",
//     answer: "Light Yagami",
//     partialAnswer: ["Light Yagami", "Light"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do mangá que deu origem ao anime 'Fullmetal Alchemist'?",
//     answer: "Fullmetal Alchemist",
//     partialAnswer: ["Fullmetal Alchemist"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do protagonista de 'Bleach'?",
//     answer: "Ichigo Kurosaki",
//     partialAnswer: ["Ichigo Kurosaki", "Ichigo"],
//   },
//   {
//     category: "geral",
//     question: "Em qual anime/mangá os personagens caçam demônios?",
//     answer: "Demon Slayer",
//     partialAnswer: ["Demon Slayer"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do protagonista de 'My Hero Academia'?",
//     answer: "Izuku Midoriya",
//     partialAnswer: ["Izuku Midoriya", "Deku"],
//   },

//   {
//     category: "geral",
//     question:
//       "Qual é o nome do encanador protagonista da série de jogos 'Super Mario'?",
//     answer: "Mario",
//     partialAnswer: ["Mario"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o nome do mascote da SEGA?",
//     answer: "Sonic",
//     partialAnswer: ["Sonic"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jogo de RPG desenvolvido pela Bethesda ambientado em um mundo pós-apocalíptico?",
//     answer: "Fallout",
//     partialAnswer: ["Fallout"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome da série de jogos de ação/aventura protagonizada por Link?",
//     answer: "The Legend of Zelda",
//     partialAnswer: ["The Legend of Zelda", "Zelda"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual jogo o jogador controla um personagem chamado Kratos, que busca vingança contra os deuses gregos?",
//     answer: "God of War",
//     partialAnswer: ["God of War"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jogo de estratégia em tempo real desenvolvido pela Blizzard que se passa no universo de ficção científica?",
//     answer: "StarCraft",
//     partialAnswer: ["StarCraft"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jogo de simulação de vida no qual o jogador cria e controla uma família virtual?",
//     answer: "The Sims",
//     partialAnswer: ["The Sims"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jogo de tiro em primeira pessoa que se passa durante a Segunda Guerra Mundial?",
//     answer: "Call of Duty",
//     partialAnswer: ["Call of Duty"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual jogo de luta o personagem principal se chama Ryu e possui um golpe especial chamado 'Hadouken'?",
//     answer: "Street Fighter",
//     partialAnswer: ["Street Fighter"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jogo online massivo que se passa em um mundo de fantasia com criaturas como orcs e elfos?",
//     answer: "World of Warcraft",
//     partialAnswer: ["World of Warcraft", "WoW"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do jogo de plataforma em que o personagem principal é um ouriço azul?",
//     answer: "Sonic the Hedgehog",
//     partialAnswer: ["Sonic the Hedgehog", "Sonic"],
//   },
//   {
//     category: "geral",
//     question:
//       "Em qual jogo o jogador assume o papel de um caçador de monstros em um mundo repleto de criaturas fantásticas?",
//     answer: "Monster Hunter",
//     partialAnswer: ["Monster Hunter"],
//   },

//   {
//     category: "geral",
//     question: "Qual é o filme vencedor do Oscar de Melhor Filme em 2020?",
//     answer: "Parasite",
//     partialAnswer: ["Parasite"],
//   },
//   {
//     category: "geral",
//     question: "Quem dirigiu o filme 'Pulp Fiction'?",
//     answer: "Quentin Tarantino",
//     partialAnswer: ["Quentin Tarantino", "Tarantino"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o nome do personagem interpretado por Robert Downey Jr. na franquia 'Iron Man'?",
//     answer: "Tony Stark",
//     partialAnswer: ["Tony Stark"],
//   },
//   {
//     category: "geral",
//     question:
//       "Qual é o filme de Quentin Tarantino que se passa durante a Segunda Guerra Mundial?",
//     answer: "Inglourious Basterds",
//     partialAnswer: ["Inglourious Basterds"],
//   },
//   {
//     category: "geral",
//     question: "Qual é o filme vencedor do Oscar de Melhor Animação em 2022?",
//     answer: "Encanto",
//     partialAnswer: ["Encanto"],
//   },

//   {
//     category: "geral",
//     question:
//       "Qual é o nome da banda britânica conhecida pelo hit 'Bohemian Rhapsody'?",
//     answer: "Queen",
//     partialAnswer: ["Queen"],
//   },
// ];

import pkg from "pg";
const { Pool } = pkg;

import venom from "venom-bot";
const { create } = venom;

// const pool = new Pool({
//   user: "postgres",
//   password: "99411520",
//   host: "localhost",
//   port: 5432,
//   database: "whatsPdf",
// });

// const { Pool } = require("pg");

const dbConfig = {
  user: "postgres",
  password: "99411520",
  host: "localhost",
  port: 5432,
  database: "whatspdf",
};

const pool = new Pool(dbConfig);

// Função para verificar a conexão com o banco de dados
async function checkDatabaseConnection() {
  const client = await pool.connect();
  try {
    console.log("Conexão bem-sucedida ao banco de dados");
  } catch (error) {
    console.error("Erro ao conectar ao banco de dados:", error);
    throw error;
  } finally {
    client.release();
  }
}

// Chamada da função para verificar a conexão
checkDatabaseConnection()
  .then(() => {
    console.log("Conexão bem-sucedida. Pronto para realizar consultas.");
    // Função para inserir as questões no banco de dados
    // async function insertQuestions() {
    //   const client = await pool.connect();
    //   try {
    //     for (const question of questions) {
    //       await client.query(
    //         "INSERT INTO questions (category, question, answer, partialAnswer) VALUES ($1, $2, $3, $4)",
    //         [
    //           question.category,
    //           question.question,
    //           question.answer,
    //           question.partialAnswer,
    //         ]
    //       );
    //     }
    //     console.log("Questões inseridas com sucesso!");
    //   } catch (error) {
    //     console.error("Erro ao inserir questões:", error);
    //     throw error;
    //   } finally {
    //     client.release();
    //   }
    // }

    // Chamada da função para inserir as questões
    // insertQuestions();
  })
  .catch((error) => {
    console.error("Erro ao verificar a conexão com o banco de dados:", error);
  });

// import fs from "fs/promises";

// async function fetchQuestions() {
//   const client = await pool.connect();
//   try {
//     const result = await client.query("SELECT * FROM questions");
//     const questions = result.rows;
//     console.log("Questões encontradas:");
//     console.log(questions);

//     const questionsString = JSON.stringify(questions, null, 2);
//     await fs.writeFile("questions.txt", questionsString);
//     console.log("Questões salvas no arquivo questions.txt");
//   } catch (error) {
//     console.error("Erro ao buscar as questões:", error);
//     throw error;
//   } finally {
//     client.release();
//   }
// }

// Chamada da função para buscar as questões e salvar no arquivo
// fetchQuestions();

// const fs = require("fs");
// import fs from 'fs/promises';

// async function fetchQuestions() {
//   const client = await pool.connect();
//   try {
//     const result = await client.query("SELECT * FROM questions");
//     const questions = result.rows;
//     console.log("Questões encontradas:");
//     console.log(questions);

//     const questionsString = JSON.stringify(questions, null, 2);
//     fs.writeFileSync("questions.txt", questionsString);
//     console.log("Questões salvas no arquivo questions.txt");
//   } catch (error) {
//     console.error("Erro ao buscar as questões:", error);
//     throw error;
//   } finally {
//     client.release();
//   }
// }

// // Chamada da função para buscar as questões e salvar no arquivo
// fetchQuestions();

// async function fetchQuestions() {
//   const client = await pool.connect();
//   try {
//     const result = await client.query("SELECT * FROM questions");
//     const questions = result.rows;
//     console.log("Questões encontradas:");
//     console.log(questions);
//   } catch (error) {
//     console.error("Erro ao buscar as questões:", error);
//     throw error;
//   } finally {
//     client.release();
//   }
// }

// // Chamada da função para buscar as questões
// fetchQuestions();

// Função para criar a tabela "questions"
// async function createQuestionsTable() {
//   const pool = new Pool(dbConfig);
//   const client = await pool.connect();

//   try {
//     await client.query(`
//       CREATE TABLE questions (
//         id SERIAL PRIMARY KEY,
//         category VARCHAR(255),
//         question TEXT,
//         answer VARCHAR(255),
//         partialAnswer TEXT[]
//       );
//     `);

//     console.log('Tabela "questions" criada com sucesso!');
//   } catch (error) {
//     console.error('Erro ao criar a tabela "questions":', error);
//     throw error;
//   } finally {
//     client.release();
//   }
// }

// // Chamada da função para criar a tabela "questions"
// createQuestionsTable();

//Função para verificar as tabelas existentes no banco de dados
// async function getTables() {
//   const pool = new Pool(dbConfig);
//   const client = await pool.connect();

//   try {
//     const queryResult = await client.query(
//       `SELECT table_name
//        FROM information_schema.tables
//        WHERE table_schema = 'public' AND table_name = 'questions'`
//     );

//     const tables = queryResult.rows.map((row) => row.table_name);
//     if (tables.includes("questions")) {
//       console.log('A tabela "questions" existe.');
//     } else {
//       console.log('A tabela "questions" não existe.');
//     }
//   } catch (error) {
//     console.error("Erro ao obter as tabelas:", error);
//     throw error;
//   } finally {
//     client.release();
//   }
// }

// // Chamada da função para obter as tabelas
// getTables();

// Função para inserir as questões no banco de dados
// async function insertQuestions() {
//   const client = await pool.connect();
//   try {
//     for (const question of questions) {
//       await client.query(
//         "INSERT INTO questions (category, question, answer, partialAnswer) VALUES ($1, $2, $3, $4)",
//         [
//           question.category,
//           question.question,
//           question.answer,
//           question.partialAnswer,
//         ]
//       );
//     }
//     console.log("Questões inseridas com sucesso!");
//   } catch (error) {
//     console.error("Erro ao inserir questões:", error);
//     throw error;
//   } finally {
//     client.release();
//   }
// }

// // Chamada da função para inserir as questões
// insertQuestions();

function cleanString(string) {
  //Remove os acentos
  const textoSemAcentos = string
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");

  //Converte para caixa baixa
  const textoSemAcentosCaixaBaixa = textoSemAcentos.toLowerCase();

  return textoSemAcentosCaixaBaixa;
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function sleep(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

function updateWinner(state, winnerName) {
  if (state.winners.hasOwnProperty(winnerName)) {
    state.winners[winnerName] += 3; //Incrementa 3 pontos para o vencedor existente
  } else {
    state.winners[winnerName] = 3; //Atribui 3 pontos para um novo vencedor
  }
}

try {
  create({
    session: "WhatsTrivia",
    multidevice: true,
  }).then((client) => {
    start(client);
    console.log("Connected to WhatsTrivia");
  });
} catch (error) {
  console.log("Error:", error);
}

function start(client) {
  let state = {
    isGameRunning: false,
    questions: [],
    answers: [],
    fix_answers: [],
    partialAnswers: [],
    currentIndex: 0,
    lastWinner: null,
    selectedQuestions: [],
    winners: {},
    isExpiredTime: false,
  };

  async function cleanStatus(client, state, message) {
    state.isGameRunning = false;
    state.answers = [];
    state.fix_answers = [];
    state.partialAnswers = [];
    state.currentIndex = 0;
    state.lastWinner = null;
    state.winners = {};
    state.isExpiredTime = false;
  }

  async function endTrivia(client, state, message) {
    await client.sendText(message.from, `Trivia finalizado`);

    if (Object.keys(state.winners).length > 0) {
      let winnersList = "Lista de Acertadores:\n";
      for (const winner in state.winners) {
        winnersList += `${winner}: ${state.winners[winner]} pontos\n`;
      }
      await client.sendText(message.from, winnersList);
    } else {
      await client.sendText(message.from, "Nenhum acertador nesta trivia.");
    }
    state.isGameRunning = false; //Adicione essa linha para finalizar a trivia

    cleanStatus(client, state, message);
  }

  /// async function endTrivia(client, state, message) {
  // await client.sendText(message.from, `Trivia finalizado`);

  //  if (Object.keys(state.winners).length > 0) {
  //    let winnersList = "Lista de Acertadores:\n";
  //     for (const winner in state.winners) {
  //       winnersList += `${winner}: ${state.winners[winner]} pontos\n`;
  //     }
  //     await client.sendText(message.from, winnersList);
  //   } else {
  //     await client.sendText(message.from, "Nenhum acertador nesta trivia.");
  //   }

  //   cleanStatus(client, state, message);
  // }

  // async function correctAnswerRace(client, state, message, startTemp) {
  //   if (startTemp === true) {
  //     state.isExpiredTime = new Promise((resolve) => {
  //       setTimeout(() => {
  //         resolve(true);
  //       }, 9999);
  //     });
  //   }

  //   Promise.race([state.isExpiredTime])
  //     .then(async (result) => {
  //       console.log("result", result);
  //       console.log("state.isExpiredTime", state.isExpiredTime);

  //       if (result === true) {
  //         console.log("state.isExpiredTime", result);

  //         await client.sendText(
  //           message.from,
  //           `A resposta correta seria:\n${
  //             state.answers[state.currentIndex]
  //           }!\nTempo Expirado,\nNinguém pontuou,\n`
  //         );

  //         // A pessoa acertou a resposta dentro do tempo
  //       } else {
  //         console.log("result", result);
  //         const winnerName = message.sender.pushname;

  //         await client.sendText(
  //           message.from,
  //           `A resposta é:\n${
  //             state.answers[state.currentIndex]
  //           }!\nParabéns, ${winnerName}! Você acertou!`
  //         );

  //         updateWinner(state, winnerName);
  //       }
  //       state.currentIndex++;
  //       checkTrivia(client, state, message);
  //     })
  //     .catch((error) => {
  //       console.log(error);
  //     });
  // }

  // async function correctAnswerRace(client, state, message, startTemp) {
  //   if (startTemp === true) {
  //     state.isExpiredTime = new Promise((resolve) => {
  //       setTimeout(() => {
  //         resolve(true);
  //       }, 9999);
  //     });
  //   }

  //   // Aguarda a resposta correta ou a expiração do tempo
  //   const result = await Promise.race([state.isExpiredTime, waitForAnswer()]);

  //   if (result === true) {
  //     await client.sendText(
  //       message.from,
  //       `A resposta correta seria:\n${state.answers[state.currentIndex]}\nTempo expirado, ninguém pontuou.`
  //     );
  //   } else {
  //     const winnerName = message.sender.pushname;

  //     await client.sendText(
  //       message.from,
  //       `A resposta é:\n${state.answers[state.currentIndex]}\nParabéns, ${winnerName}! Você acertou!`
  //     );

  //     updateWinner(state, winnerName);
  //   }

  //   state.currentIndex++;
  //   checkTrivia(client, state, message);

  //   async function waitForAnswer() {
  //     return new Promise((resolve) => {
  //       client.onAnyMessage((msg) => {
  //         const msg_body = cleanString(msg.body);
  //         const expectedAnswer = cleanString(state.answers[state.currentIndex]);

  //         if (msg.from === message.from && msg_body === expectedAnswer) {
  //           resolve(false); // A resposta está correta
  //         }
  //       });
  //     });
  //   }
  // }

  async function correctAnswerRace(client, state, message, startTemp) {
    console.log("correctAnswerRace state.isGameRunning=>", state.isGameRunning);

    const isGameRunning = checkTrivia(client, state, message);
    console.log("correctAnswerRace isGameRunning", isGameRunning);

    if (isGameRunning === false) {
      endTrivia(client, state, message);
      return;
    } else {
      if (startTemp === true) {
        state.isExpiredTime = new Promise((resolve) => {
          setTimeout(() => {
            resolve(true);
          }, 9999);
        });
      }

      try {
        const result = await Promise.race([
          state.isExpiredTime,
          waitForAnswer(),
        ]);

        if (result === true) {
          await client.sendText(
            message.from,
            `A resposta correta seria:\n${
              state.answers[state.currentIndex]
            }\nTempo expirado, ninguém pontuou.`
          );
        } else {
          const winnerName = message.sender.pushname;

          await client.sendText(
            message.from,
            `A resposta é:\n${
              state.answers[state.currentIndex]
            }\nParabéns, ${winnerName}! Você acertou!`
          );

          updateWinner(state, winnerName);
        }
        state.currentIndex++;

        checkTrivia(client, state, message);
      } catch (error) {
        // Lida com erros de forma apropriada
        console.error("Erro:", error);
      }
    }

    function waitForAnswer() {
      return new Promise((resolve) => {
        client.onAnyMessage((msg) => {
          const msg_body = cleanString(msg.body);
          const expectedAnswer = cleanString(state.answers[state.currentIndex]);

          if (msg.from === message.from && msg_body === expectedAnswer) {
            resolve(false); // A resposta está correta
          }
        });
      });
    }
  }

  // async function sendQuestions(client, state, message) {
  //   console.log("sendQuestions");
  //   console.log("state.currentIndex", state.currentIndex);
  //   console.log(
  //     "state.selectedQuestions.length",
  //     state.selectedQuestions.length
  //   );

  //   await sleep(1212); // Delay de x segundos antes de mostrar a próxima pergunta
  //   let question = state.questions[state.currentIndex];
  //   await client.sendText(message.from, `${question}`);
  //   correctAnswerRace(client, state, message, true);
  // }

  async function sendQuestions(client, state, message) {
    console.log("sendQuestions");
    console.log("state.currentIndex", state.currentIndex);
    console.log(
      "state.selectedQuestions.length",
      state.selectedQuestions.length
    );

    // Verifica se a trivia já foi finalizada
    if (state.currentIndex >= state.selectedQuestions.length) {
      await client.sendText(message.from, `Trivia finalizado`);
      await showWinners(client, state, message); // Exibe a lista de vencedores
      endTrivia(client, state, message);
      cleanStatus(client, state, message);
      return; // Interrompe a função
    }

    await sleep(1212); // Delay de x segundos antes de mostrar a próxima pergunta
    let question = state.questions[state.currentIndex];
    await client.sendText(message.from, `${question}`);
  }

  async function startTriviardy(whatsappClient, state, message) {
    const dbClient = await pool.connect();
    try {
      const result = await dbClient.query(
        "SELECT * FROM questions ORDER BY RANDOM() LIMIT 6"
      );
      const selectedQuestions = result.rows;

      state.selectedQuestions = selectedQuestions;
      state.questions = selectedQuestions.map((q) => q.question);
      state.answers = selectedQuestions.map((q) => q.answer);

      state.fix_answers = selectedQuestions.map((q) => cleanString(q.answer));

      console.log(
        "state.questions",
        state.questions,
        "indice",
        state.currentIndex
      );
      console.log("state.answers", state.answers, "indice", state.currentIndex);
      console.log(
        "state.fix_answers",
        state.fix_answers,
        "indice",
        state.currentIndex
      );

      await whatsappClient.sendText(message.from, `Trivia iniciado`);
      state.isGameRunning = true;
      checkTrivia(whatsappClient, state, message);
    } catch (error) {
      console.error("Erro ao iniciar o Triviardy:", error);
      throw error;
    } finally {
      dbClient.release();
    }
  }

  // async function startTriviardy(client, state, message) {
  //   state.selectedQuestions = shuffle(questions).slice(0, 6);
  //   state.questions = state.selectedQuestions.map((q) => q.question);
  //   state.answers = state.selectedQuestions.map((q) => q.answer);

  //   state.fix_answers = state.selectedQuestions.map((q) =>
  //     cleanString(q.answer)
  //   );

  //   console.log(
  //     "state.questions",
  //     state.questions,
  //     "indice",
  //     state.currentIndex
  //   );
  //   console.log("state.answers", state.answers, "indice", state.currentIndex);
  //   console.log(
  //     "state.fix_answers",
  //     state.fix_answers,
  //     "indice",
  //     state.currentIndex
  //   );

  //   await client.sendText(message.from, `Trivia iniciado`);
  //   state.isGameRunning = true;
  //   checkTrivia(client, state, message);
  // }

  // async function startTriviardy(client, state, message) {
  //   // const client = await pool.connect();
  //   try {
  //     const result = await client.query(
  //       "SELECT * FROM questions ORDER BY RANDOM() LIMIT 6"
  //     );
  //     const selectedQuestions = result.rows;

  //     state.selectedQuestions = selectedQuestions;
  //     state.questions = selectedQuestions.map((q) => q.question);
  //     state.answers = selectedQuestions.map((q) => q.answer);

  //     state.fix_answers = selectedQuestions.map((q) => cleanString(q.answer));

  //     console.log(
  //       "state.questions",
  //       state.questions,
  //       "indice",
  //       state.currentIndex
  //     );
  //     console.log("state.answers", state.answers, "indice", state.currentIndex);
  //     console.log(
  //       "state.fix_answers",
  //       state.fix_answers,
  //       "indice",
  //       state.currentIndex
  //     );

  //     await client.sendText(message.from, `Trivia iniciado`);
  //     state.isGameRunning = true;
  //     checkTrivia(client, state, message);
  //   } catch (error) {
  //     console.error("Erro ao iniciar o Triviardy:", error);
  //     throw error;
  //   } finally {
  //     client.release();
  //   }
  // }

  async function checkTrivia(client, state, message) {
    if (state.currentIndex >= state.selectedQuestions.length) {
      return false;
      // endTrivia(client, state, message);
    }

    if (
      state.currentIndex < state.selectedQuestions.length &&
      state.isGameRunning == true
    ) {
      sendQuestions(client, state, message);
      correctAnswerRace(client, state, message, true); // Chamada corrigida
    }
  }

  client.onAnyMessage(async (message) => {
    let msg_body = cleanString(message.body);

    if (message.body == "!endtrivia") {
      await client.sendText(message.from, `Trivia interrompido`);
      endTrivia(client, state, message);
    }

    if (message.body == "!trivia" && state.isGameRunning === true) {
      await client.sendText(
        message.from,
        `Trivia já inicializado, aguarde finalizar`
      );
    }

    if (message.body === "!trivia" && state.isGameRunning === false) {
      startTriviardy(client, state, message);
    }

    if (
      msg_body === state.fix_answers[state.currentIndex] &&
      state.isGameRunning === true
    ) {
      console.log("msg_body", msg_body);
      console.log(
        "state.fix_answers[state.currentIndex]",
        state.fix_answers[state.currentIndex]
      );

      correctAnswerRace(client, state, message, false);
    }
  });
}
